<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubuntu Resource Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #16162a;
            --bg-hover: #252545;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --accent-yellow: #ffcc00;
            --accent-orange: #ff8844;
            --accent-red: #ff4444;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --border-color: #2a2a45;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.3), 0 2px 4px -1px rgba(0,0,0,0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.4), 0 4px 6px -2px rgba(0,0,0,0.3);
            --radius: 12px;
            --radius-sm: 8px;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        .bg-gradient {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at 10% 20%, rgba(0,212,255,0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 90% 80%, rgba(168,85,247,0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 50% 50%, rgba(236,72,153,0.05) 0%, transparent 70%);
            pointer-events: none; z-index: 0;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; position: relative; z-index: 1; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); flex-wrap: wrap; gap: 16px; }
        .brand { display: flex; align-items: center; gap: 16px; }
        .logo { width: 48px; height: 48px; background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple)); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 0 20px rgba(0,212,255,0.3); }
        .brand-text h1 { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .brand-text p { color: var(--text-secondary); font-size: 0.875rem; }
        .header-info { display: flex; align-items: center; gap: 24px; flex-wrap: wrap; }
        .status-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; color: var(--text-secondary); }
        .status-dot { width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.1); } }
        .refresh-btn { background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 16px; border-radius: var(--radius-sm); cursor: pointer; font-size: 0.875rem; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
        .refresh-btn:hover { background: var(--bg-hover); border-color: var(--accent-cyan); }
        .refresh-btn.spinning svg { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin-bottom: 24px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); border-color: rgba(0,212,255,0.2); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-title { display: flex; align-items: center; gap: 12px; font-size: 1rem; font-weight: 600; color: var(--text-primary); }
        .card-icon { width: 40px; height: 40px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
        .icon-cyan { background: rgba(0,212,255,0.15); }
        .icon-green { background: rgba(0,255,136,0.15); }
        .icon-yellow { background: rgba(255,204,0,0.15); }
        .icon-orange { background: rgba(255,136,68,0.15); }
        .icon-purple { background: rgba(168,85,247,0.15); }
        .icon-pink { background: rgba(236,72,153,0.15); }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .badge-cyan { background: rgba(0,212,255,0.15); color: var(--accent-cyan); }
        .badge-green { background: rgba(0,255,136,0.15); color: var(--accent-green); }
        .badge-yellow { background: rgba(255,204,0,0.15); color: var(--accent-yellow); }
        .badge-orange { background: rgba(255,136,68,0.15); color: var(--accent-orange); }
        .badge-red { background: rgba(255,68,68,0.15); color: var(--accent-red); }
        .metric-value { font-size: 2.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-bottom: 8px; background: linear-gradient(135deg, var(--text-primary), var(--text-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .metric-label { color: var(--text-secondary); font-size: 0.875rem; }
        .progress-bar { height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease, background-color 0.3s ease; }
        .progress-cyan { background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple)); }
        .progress-green { background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); }
        .progress-yellow { background: linear-gradient(90deg, var(--accent-yellow), var(--accent-orange)); }
        .progress-red { background: linear-gradient(90deg, var(--accent-red), var(--accent-orange)); }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 16px; }
        .stat-item { background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); }
        .stat-value { font-size: 1.25rem; font-weight: 600; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px; }
        .full-width { grid-column: 1 / -1; }
        .process-list { max-height: 400px; overflow-y: auto; }
        .process-list::-webkit-scrollbar { width: 6px; }
        .process-list::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 3px; }
        .process-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        .process-item { display: flex; align-items: center; padding: 12px; border-radius: var(--radius-sm); transition: background 0.2s; gap: 12px; }
        .process-item:hover { background: var(--bg-hover); }
        .process-item:not(:last-child) { border-bottom: 1px solid var(--border-color); }
        .kill-btn { width: 32px; height: 32px; background: rgba(255,68,68,0.15); border: 1px solid var(--accent-red); color: var(--accent-red); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; transition: all 0.2s; flex-shrink: 0; }
        .kill-btn:hover { background: var(--accent-red); color: white; transform: scale(1.1); }
        .kill-btn:active { transform: scale(0.95); }
        .kill-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .process-rank { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.75rem; border-radius: 6px; margin-right: 12px; }
        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #a06020); color: #fff; }
        .rank-other { background: var(--bg-secondary); color: var(--text-secondary); }
        .process-info { flex: 1; min-width: 0; }
        .process-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .process-meta { font-size: 0.75rem; color: var(--text-secondary); }
        .process-cpu { text-align: right; margin-right: 8px; }
        .process-cpu-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-cyan); }
        .process-mem { font-size: 0.75rem; color: var(--text-secondary); }
        .disk-grid { display: grid; gap: 12px; }
        .disk-item { background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); }
        .disk-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .disk-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .disk-mount { font-size: 0.75rem; color: var(--text-secondary); background: var(--bg-card); padding: 2px 8px; border-radius: 4px; }
        .disk-stats { display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px; }
        .network-grid { display: grid; gap: 12px; }
        .network-item { background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); }
        .network-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .network-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .network-mac { font-size: 0.75rem; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; }
        .network-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
        .network-stat { display: flex; align-items: center; gap: 8px; }
        .network-stat-icon { font-size: 1rem; }
        .network-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; }
        .network-stat-label { font-size: 0.75rem; color: var(--text-secondary); }
        .load-bars { display: flex; gap: 16px; margin-top: 16px; }
        .load-bar { flex: 1; text-align: center; }
        .load-value { font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .load-label { font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px; }
        .cores-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 8px; margin-top: 16px; }
        .core-item { background: var(--bg-secondary); padding: 8px; border-radius: var(--radius-sm); text-align: center; }
        .core-number { font-size: 0.625rem; color: var(--text-secondary); text-transform: uppercase; }
        .core-value { font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; font-weight: 600; color: var(--accent-cyan); }
        .skeleton { background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-hover) 50%, var(--bg-secondary) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .error-message { background: rgba(255,68,68,0.1); border: 1px solid var(--accent-red); color: var(--accent-red); padding: 12px 16px; border-radius: var(--radius-sm); margin-bottom: 16px; }
        .uptime-display { font-family: 'JetBrains Mono', monospace; font-size: 1.125rem; color: var(--accent-cyan); }
        @media (max-width: 768px) { .dashboard-grid { grid-template-columns: 1fr; } .header-info { width: 100%; justify-content: space-between; } }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="container">
        <header>
            <div class="brand">
                <div class="logo">üìä</div>
                <div class="brand-text">
                    <h1>Ubuntu Resource Monitor</h1>
                    <p id="hostname">Loading...</p>
                </div>
            </div>
            <div class="header-info">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span id="status-text">System Online</span>
                </div>
                <button class="refresh-btn" onclick="window.location.href='/docker'" style="margin-right: 8px;">
                    üê≥ Docker
                </button>
                <button class="refresh-btn" onclick="window.location.href='/nginx'" style="margin-right: 8px;">
                    üîÑ Nginx Manager
                </button>
                <button class="refresh-btn" onclick="refreshAll()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    Refresh
                </button>
            </div>
        </header>

        <div id="error-container"></div>

        <div class="dashboard-grid">
            <!-- CPU Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-cyan">üíª</div>
                        CPU Usage
                    </div>
                    <span class="badge badge-cyan" id="cpu-badge">Loading</span>
                </div>
                <div class="metric-value" id="cpu-value">--</div>
                <div class="metric-label">Overall CPU Usage</div>
                <div class="progress-bar"><div class="progress-fill progress-cyan" id="cpu-bar" style="width: 0%"></div></div>
                <div class="cores-grid" id="cores-grid"></div>
            </div>

            <!-- Memory Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-green">üß†</div>
                        Memory
                    </div>
                    <span class="badge badge-green" id="mem-badge">-- GB</span>
                </div>
                <div class="metric-value" id="mem-value">--</div>
                <div class="metric-label" id="mem-label">Used / Total</div>
                <div class="progress-bar"><div class="progress-fill progress-green" id="mem-bar" style="width: 0%"></div></div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="mem-free">--</div>
                        <div class="stat-label">Free</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="mem-available">--</div>
                        <div class="stat-label">Available</div>
                    </div>
                </div>
            </div>

            <!-- System Info Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-purple">üñ•Ô∏è</div>
                        System Info
                    </div>
                    <span class="badge badge-purple" id="arch-badge">--</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" style="font-size: 0.875rem;" id="os-name">--</div>
                        <div class="stat-label">Operating System</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="font-size: 0.875rem;" id="kernel">--</div>
                        <div class="stat-label">Kernel Version</div>
                    </div>
                    <div class="stat-item full-width">
                        <div class="uptime-display" id="uptime">--</div>
                        <div class="stat-label">System Uptime</div>
                    </div>
                </div>
            </div>

            <!-- Load Average Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-yellow">‚ö°</div>
                        Load Average
                    </div>
                    <span class="badge badge-yellow">Real-time</span>
                </div>
                <div class="load-bars">
                    <div class="load-bar">
                        <div class="load-value" id="load-1">--</div>
                        <div class="load-label">1 min</div>
                    </div>
                    <div class="load-bar">
                        <div class="load-value" id="load-5">--</div>
                        <div class="load-label">5 min</div>
                    </div>
                    <div class="load-bar">
                        <div class="load-value" id="load-15">--</div>
                        <div class="load-label">15 min</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disks Section -->
        <div class="dashboard-grid">
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-orange">üíæ</div>
                        Disk Usage
                    </div>
                </div>
                <div class="disk-grid" id="disk-grid">
                    <div class="skeleton" style="height: 80px;"></div>
                    <div class="skeleton" style="height: 80px;"></div>
                </div>
            </div>
        </div>

        <!-- Network Section -->
        <div class="dashboard-grid">
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-pink">üåê</div>
                        Network Interfaces
                    </div>
                </div>
                <div class="network-grid" id="network-grid">
                    <div class="skeleton" style="height: 100px;"></div>
                </div>
            </div>
        </div>

        <!-- Processes Section -->
        <div class="dashboard-grid">
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon icon-cyan">üîß</div>
                        Top Prosesl…ôr
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <select id="sort-select" class="refresh-btn" style="padding: 6px 12px;" onchange="loadProcesses()">
                            <option value="cpu">CPU istifad…ôsi</option>
                            <option value="memory">Memory istifad…ôsi</option>
                        </select>
                        <span class="badge badge-cyan" id="process-count">--</span>
                    </div>
                </div>
                <div class="process-list" id="process-list">
                    <div class="skeleton" style="height: 50px; margin-bottom: 8px;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 8px;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 8px;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 8px;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let refreshInterval;

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDuration(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            if (days > 0) return `${days}d ${hours}h ${minutes}m`;
            if (hours > 0) return `${hours}h ${minutes}m ${secs}s`;
            return `${minutes}m ${secs}s`;
        }

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        async function fetchData(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                showError(`Failed to load ${endpoint}: ${error.message}`);
                return null;
            }
        }

        async function loadSystemInfo() {
            const data = await fetchData('/api/system');
            if (!data) return;
            document.getElementById('hostname').textContent = `${data.hostname} ‚Ä¢ ${data.os_version}`;
            document.getElementById('os-name').textContent = data.os_name;
            document.getElementById('kernel').textContent = data.kernel_version;
            document.getElementById('uptime').textContent = formatDuration(data.uptime_seconds);
        }

        async function loadCpuInfo() {
            const info = await fetchData('/api/cpu');
            if (info) document.getElementById('arch-badge').textContent = info.architecture;
        }

        async function loadCpuUsage() {
            const data = await fetchData('/api/cpu/usage');
            if (!data) return;
            const usage = data.overall_usage_percent.toFixed(1);
            document.getElementById('cpu-value').textContent = `${usage}%`;
            document.getElementById('cpu-bar').style.width = `${Math.min(usage, 100)}%`;
            const badge = document.getElementById('cpu-badge');
            badge.textContent = `${data.per_core_usage.length} Cores`;
            const coresGrid = document.getElementById('cores-grid');
            coresGrid.innerHTML = data.per_core_usage.map((core, i) => {
                const color = core > 80 ? 'var(--accent-red)' : core > 50 ? 'var(--accent-yellow)' : 'var(--accent-cyan)';
                return `<div class="core-item"><div class="core-number">CPU${i}</div><div class="core-value" style="color:${color}">${core.toFixed(0)}%</div></div>`;
            }).join('');
        }

        async function loadMemory() {
            const data = await fetchData('/api/memory');
            if (!data) return;
            document.getElementById('mem-value').textContent = `${data.used_percent.toFixed(1)}%`;
            document.getElementById('mem-label').textContent = `${data.used_gb.toFixed(2)} GB / ${data.total_gb.toFixed(2)} GB`;
            document.getElementById('mem-bar').style.width = `${Math.min(data.used_percent, 100)}%`;
            document.getElementById('mem-badge').textContent = `${data.total_gb.toFixed(1)} GB`;
            document.getElementById('mem-free').textContent = `${data.free_gb.toFixed(2)} GB`;
            document.getElementById('mem-available').textContent = `${data.available_gb.toFixed(2)} GB`;
        }

        async function loadDisks() {
            const data = await fetchData('/api/disks');
            if (!data) return;
            const grid = document.getElementById('disk-grid');
            grid.innerHTML = data.map(disk => {
                const percent = disk.used_percent;
                const barClass = percent > 90 ? 'progress-red' : percent > 70 ? 'progress-yellow' : 'progress-cyan';
                return `<div class="disk-item">
                    <div class="disk-header">
                        <span class="disk-name">üìÅ ${disk.name || 'Unknown'}</span>
                        <span class="disk-mount">${disk.mount_point}</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill ${barClass}" style="width: ${percent}%"></div></div>
                    <div class="disk-stats">
                        <span>${disk.used_gb.toFixed(2)} GB used (${percent.toFixed(1)}%)</span>
                        <span>${disk.available_gb.toFixed(2)} GB free / ${disk.total_gb.toFixed(2)} GB total</span>
                    </div>
                </div>`;
            }).join('');
        }

        async function loadNetwork() {
            const data = await fetchData('/api/network');
            if (!data) return;
            const grid = document.getElementById('network-grid');
            grid.innerHTML = data.map(net => `<div class="network-item">
                <div class="network-header">
                    <span class="network-name">üì° ${net.interface_name}</span>
                    <span class="network-mac">${net.mac_address || 'N/A'}</span>
                </div>
                <div class="network-stats">
                    <div class="network-stat">
                        <span class="network-stat-icon">‚¨áÔ∏è</span>
                        <div>
                            <div class="network-stat-value">${formatBytes(net.received_bytes)}</div>
                            <div class="network-stat-label">Received (${net.received_packets} pkts)</div>
                        </div>
                    </div>
                    <div class="network-stat">
                        <span class="network-stat-icon">‚¨ÜÔ∏è</span>
                        <div>
                            <div class="network-stat-value">${formatBytes(net.transmitted_bytes)}</div>
                            <div class="network-stat-label">Transmitted (${net.transmitted_packets} pkts)</div>
                        </div>
                    </div>
                </div>
            </div>`).join('');
        }

        async function loadLoadAverage() {
            const data = await fetchData('/api/load');
            if (!data) return;
            document.getElementById('load-1').textContent = data.one_min.toFixed(2);
            document.getElementById('load-5').textContent = data.five_min.toFixed(2);
            document.getElementById('load-15').textContent = data.fifteen_min.toFixed(2);
        }

        async function killProcess(pid, name) {
            if (!confirm(`${name} prosesini dayandƒ±rmaq ist…ôdiyinizd…ôn …ôminsiniz? (PID: ${pid})`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/processes/${pid}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                
                if (result.success) {
                    showError(`‚úÖ ${result.message}`);
                    setTimeout(() => loadProcesses(), 500);
                } else {
                    showError(`‚ùå ${result.message}`);
                }
            } catch (error) {
                showError(`‚ùå Proses dayandƒ±rƒ±la bilm…ôdi: ${error.message}`);
            }
        }

        async function loadProcesses() {
            const data = await fetchData('/api/processes?limit=20');
            if (!data) return;
            
            const sortBy = document.getElementById('sort-select').value;
            const sorted = [...data].sort((a, b) => {
                if (sortBy === 'memory') {
                    return b.memory_bytes - a.memory_bytes;
                }
                return b.cpu_usage - a.cpu_usage;
            });
            
            document.getElementById('process-count').textContent = `${sorted.length} proses`;
            
            const list = document.getElementById('process-list');
            list.innerHTML = sorted.map((proc, i) => {
                const rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : 'rank-other';
                const runtime = formatDuration(proc.runtime_seconds);
                return `<div class="process-item">
                    <div class="process-rank ${rankClass}">${i + 1}</div>
                    <div class="process-info">
                        <div class="process-name">${proc.name}</div>
                        <div class="process-meta">PID: ${proc.pid} ‚Ä¢ Runtime: ${runtime}</div>
                    </div>
                    <div class="process-cpu">
                        <div class="process-cpu-value">${proc.cpu_usage.toFixed(1)}%</div>
                        <div class="process-mem">${proc.memory_mb.toFixed(1)} MB</div>
                    </div>
                    <button class="kill-btn" onclick="killProcess(${proc.pid}, '${proc.name.replace(/'/g, "\\'")}')">‚úï</button>
                </div>`;
            }).join('');
        }

        async function refreshAll() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('spinning');
            await Promise.all([loadSystemInfo(), loadCpuInfo(), loadCpuUsage(), loadMemory(), loadDisks(), loadNetwork(), loadLoadAverage(), loadProcesses()]);
            btn.classList.remove('spinning');
        }

        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                loadCpuUsage();
                loadMemory();
                loadLoadAverage();
                loadProcesses();
                loadNetwork();
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', () => { refreshAll(); startAutoRefresh(); });
    </script>
</body>
</html>
